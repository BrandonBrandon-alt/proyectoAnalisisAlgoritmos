<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Requerimiento 3 – Resultados</title>
    <style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

:root {
  --primary: #7c3aed;
  --primary-dark: #6d28d9;
  --primary-light: #a78bfa;
  --secondary: #06b6d4;
  --background: #0f172a;
  --surface: #1e293b;
  --card: #334155;
  --text: #f1f5f9;
  --text-muted: #94a3b8;
  --accent: #f59e0b;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  background: var(--background);
  color: var(--text);
  min-height: 100vh;
  position: relative;
  overflow-x: hidden;
  padding: 20px;
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: 
    radial-gradient(circle at 20% 50%, rgba(124, 58, 237, 0.15) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(6, 182, 212, 0.15) 0%, transparent 50%);
  pointer-events: none;
  z-index: 0;
}

.wrap {
  max-width: 1400px;
  margin: 0 auto;
  position: relative;
  z-index: 1;
}

h1 {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 12px;
  background: linear-gradient(135deg, var(--primary-light), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.lead {
  font-size: 1.1rem;
  color: var(--text-muted);
  margin-bottom: 32px;
  line-height: 1.6;
}

button {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 0.95rem;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
}

button:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(124, 58, 237, 0.5);
}

button:disabled {
  background: var(--card);
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.muted {
  color: var(--text-muted);
  font-size: 0.9rem;
}

.grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
  margin-top: 24px;
}

.full-width {
  grid-column: 1 / -1;
}

@media (max-width: 900px) {
  .grid {
    grid-template-columns: 1fr;
  }
}

.card {
  background: var(--surface);
  border-radius: 16px;
  padding: 24px;
  border: 1px solid rgba(148, 163, 184, 0.1);
  transition: all 0.3s;
}

.card:hover {
  border-color: rgba(124, 58, 237, 0.3);
  box-shadow: 0 8px 24px rgba(124, 58, 237, 0.2);
}

.card strong {
  display: block;
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 16px;
  color: var(--text);
}

.status {
  padding: 16px;
  background: var(--card);
  border-radius: 10px;
  font-size: 0.95rem;
  border: 1px solid rgba(148, 163, 184, 0.1);
}

.preview {
  max-width: 100%;
  border-radius: 12px;
  border: 1px solid rgba(148, 163, 184, 0.2);
  margin-top: 12px;
  transition: transform 0.3s;
}

.preview:hover {
  transform: scale(1.02);
}

.btn-link {
  display: inline-block;
  padding: 10px 20px;
  background: linear-gradient(135deg, #16a34a, #15803d);
  color: white;
  text-decoration: none;
  border-radius: 10px;
  font-size: 0.9rem;
  font-weight: 600;
  transition: all 0.3s;
  box-shadow: 0 4px 12px rgba(22, 163, 74, 0.3);
}

.btn-link:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(22, 163, 74, 0.5);
  background: linear-gradient(135deg, #15803d, #166534);
}

pre {
  background: var(--card);
  color: var(--text);
  padding: 16px;
  border-radius: 10px;
  overflow: auto;
  font-family: 'Courier New', monospace;
  font-size: 0.85rem;
  border: 1px solid rgba(148, 163, 184, 0.1);
  line-height: 1.5;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 12px;
  font-size: 0.9rem;
}

th {
  background: var(--card);
  color: var(--text);
  padding: 12px;
  text-align: left;
  font-weight: 600;
  border-bottom: 2px solid var(--primary);
}

td {
  padding: 12px;
  border-bottom: 1px solid rgba(148, 163, 184, 0.1);
}

tbody tr:hover {
  background: var(--card);
}

code {
  background: var(--card);
  padding: 4px 8px;
  border-radius: 6px;
  font-family: 'Courier New', monospace;
  font-size: 0.85rem;
  color: var(--primary-light);
}

.top-list table {
  margin-top: 0;
}

.table-container {
  max-height: 400px;
  overflow-y: auto;
}

.table-container::-webkit-scrollbar {
  width: 8px;
}

.table-container::-webkit-scrollbar-track {
  background: var(--card);
  border-radius: 4px;
}

.table-container::-webkit-scrollbar-thumb {
  background: var(--primary);
  border-radius: 4px;
}

.table-container::-webkit-scrollbar-thumb:hover {
  background: var(--primary-dark);
}
    </style>
</head>
<body>
<div class="wrap">
    <div style="margin-bottom: 24px;">
        <a href="../../index.html" style="display: inline-flex; align-items: center; gap: 8px; color: var(--text-muted); text-decoration: none; font-size: 0.9rem; transition: color 0.3s;">
            <span style="font-size: 1.2rem;">←</span> Volver al inicio
        </a>
    </div>
    
    <h1>Requerimiento 3 — Análisis de Texto</h1>
    <p class="lead">Pulsa el botón para cargar los resultados del análisis de texto generados por el notebook.</p>

    <div>
        <button id="loadBtn">Cargar resultados</button>
        <span id="msg" class="muted" style="margin-left:12px"></span>
    </div>

    <div class="grid">
        <!-- Fila 0: Resumen (fusionada) -->
        <div id="summary" class="card full-width">
            <strong>Resumen del Análisis</strong>
            <div class="status" id="summaryText">No se ha cargado ningún archivo todavía.</div>
            <div id="counts" style="margin-top:8px"></div>
        </div>

        <!-- Fila 1: Top 15 -->
        <div id="top15Card" class="card" style="display:none;">
            <strong>Top 15 Palabras Más Frecuentes</strong>
            <div class="table-container">
                <div class="top-list" id="top15Words"></div>
            </div>
            <div style="margin-top:12px;">
                <a id="top15Link" class="btn-link" download style="display:none;">Descargar CSV</a>
            </div>
        </div>

        <div class="card" style="display:none;" id="top15ImgCard">
            <strong>Visualización Top 15</strong>
            <img id="top15Img" class="preview" alt="Top 15 palabras" style="display:none" />
            <div id="top15Msg" class="muted" style="margin-top:6px"></div>
        </div>

        <!-- Fila 2: Categorías -->
        <div id="categoriesCard" class="card" style="display:none;">
            <strong>Frecuencias por Categoría</strong>
            <div class="table-container">
                <div class="top-list" id="categoriesTable"></div>
            </div>
            <div style="margin-top:12px;">
                <a id="categoriesLink" class="btn-link" download style="display:none;">Descargar CSV</a>
            </div>
        </div>

        <div class="card" style="display:none;" id="categoriesImgCard">
            <strong>Visualización Categorías</strong>
            <img id="categoriesImg" class="preview" alt="Frecuencias por categoría" style="display:none" />
            <div id="categoriesMsg" class="muted" style="margin-top:6px"></div>
        </div>

        <!-- Fila 3: Logs (fusionada) -->
        <div class="card full-width">
            <strong>Logs</strong>
            <pre id="log" style="height:180px">Esperando acción...</pre>
        </div>
    </div>

    <script>
        // Rutas relativas desde este archivo (requerimiento3/index.html)
        // Todos los archivos están en la misma carpeta del HTML
        const paths = {
            freqCategories: './frecuencias_palabras_categoria.csv',
            top15: './top15_palabras_frecuentes.csv',
            imgCategories: './frecuencia_palabras_categoria.png',
            imgTop15: './top15_palabras.png'
        };

        const logEl = document.getElementById('log');
        function log(...args){ logEl.textContent = args.join(' ') + "\n\n" + logEl.textContent; }

        function showMsg(text){ document.getElementById('msg').textContent = text; }

        async function fetchText(path){
            try{
                const res = await fetch(path);
                if(!res.ok) throw new Error('HTTP ' + res.status);
                return await res.text();
            } catch(e){
                throw new Error(`No disponible: ${path} (${e.message})`);
            }
        }

        function parseCSVSimple(text){
            const lines = text.split(/\r?\n/).filter(l => l.trim() !== '');
            if(lines.length === 0) return {headers:[], rows:[]};
            const headers = lines[0].split(',').map(h => h.replace(/^"|"$/g,'').trim());
            const rows = lines.slice(1).map(line => {
                const values = [];
                let cur = '', inQ=false;
                for(let i=0;i<line.length;i++){
                    const ch = line[i];
                    if(ch === '"' ) { inQ = !inQ; continue; }
                    if(ch === ',' && !inQ){ values.push(cur); cur=''; continue; }
                    cur += ch;
                }
                values.push(cur);
                while(values.length < headers.length) values.push('');
                return headers.reduce((o,k,i)=>{ o[k]= (values[i]||'').trim(); return o; }, {});
            });
            return {headers, rows};
        }

        async function checkImage(url){
            try{
                const r = await fetch(url, {method:'HEAD'});
                return r.ok;
            }catch(e){
                return false;
            }
        }

        document.getElementById('loadBtn').addEventListener('click', async function(){
            const btn = this;
            btn.disabled = true;
            showMsg('Cargando...');
            log('Inicio de carga de resultados');
            
            try{
                // Fetch top15_palabras_frecuentes.csv
                let top15Text=null;
                try{
                    top15Text = await fetchText(paths.top15);
                    log('top15_palabras_frecuentes.csv cargado:', paths.top15);
                } catch(e){
                    log(e.message);
                }

                // Fetch frecuencia_palabras_categoria.csv
                let categoriesText=null;
                try{
                    categoriesText = await fetchText(paths.freqCategories);
                    log('frecuencias_palabras_categoria.csv cargado:', paths.freqCategories);
                } catch(e){
                    log(e.message);
                }

                // Check images
                const top15ImgOk = await checkImage(paths.imgTop15);
                const categoriesImgOk = await checkImage(paths.imgCategories);

                // Update summary
                const summaryEl = document.getElementById('summaryText');
                if(!top15Text && !categoriesText){
                    summaryEl.textContent = 'No se encontraron los archivos CSV en la ruta esperada.';
                    document.getElementById('counts').textContent = '';
                } else {
                    let top15Data = {headers:[], rows:[]};
                    let categoriesData = {headers:[], rows:[]};
                    
                    if(top15Text) top15Data = parseCSVSimple(top15Text);
                    if(categoriesText) categoriesData = parseCSVSimple(categoriesText);

                    const totalTop15 = top15Data.rows.length;
                    const totalCategories = categoriesData.rows.length;

                    summaryEl.innerHTML = `Top 15 palabras cargadas: <strong>${totalTop15}</strong><br>Categorías analizadas: <strong>${totalCategories}</strong>`;
                    const countsEl = document.getElementById('counts');
                    countsEl.innerHTML = `<div class="muted">Todos los archivos deben estar en la misma carpeta que este HTML.</div>`;
                }

                // Process Top 15
                const top15Card = document.getElementById('top15Card');
                const top15Container = document.getElementById('top15Words');
                const top15Link = document.getElementById('top15Link');
                const top15ImgCard = document.getElementById('top15ImgCard');
                const top15Img = document.getElementById('top15Img');
                const top15ImgMsg = document.getElementById('top15Msg');

                if(top15Text){
                    const top15Data = parseCSVSimple(top15Text);
                    top15Card.style.display = 'block';
                    const headers = top15Data.headers;
                    top15Container.innerHTML = '<table><thead><tr>' 
                        + headers.map(h => `<th>${h}</th>`).join('')
                        + '</tr></thead><tbody>'
                        + top15Data.rows.map(r => '<tr>' + headers.map(h => `<td>${r[h] || ''}</td>`).join('') + '</tr>').join('')
                        + '</tbody></table>';
                    
                    top15Link.href = paths.top15;
                    top15Link.style.display = 'inline-block';
                } else {
                    top15Card.style.display = 'none';
                }

                if(top15ImgOk){
                    top15ImgCard.style.display = 'block';
                    top15Img.src = paths.imgTop15;
                    top15Img.style.display = 'block';
                    top15ImgMsg.textContent = '';
                } else {
                    top15ImgCard.style.display = 'none';
                    top15ImgMsg.textContent = 'Imagen no encontrada: ' + paths.imgTop15;
                }

                // Process Categories
                const categoriesCard = document.getElementById('categoriesCard');
                const categoriesContainer = document.getElementById('categoriesTable');
                const categoriesLink = document.getElementById('categoriesLink');
                const categoriesImgCard = document.getElementById('categoriesImgCard');
                const categoriesImg = document.getElementById('categoriesImg');
                const categoriesImgMsg = document.getElementById('categoriesMsg');

                if(categoriesText){
                    const categoriesData = parseCSVSimple(categoriesText);
                    categoriesCard.style.display = 'block';
                    const headers = categoriesData.headers;
                    categoriesContainer.innerHTML = '<table><thead><tr>' 
                        + headers.map(h => `<th>${h}</th>`).join('')
                        + '</tr></thead><tbody>'
                        + categoriesData.rows.map(r => '<tr>' + headers.map(h => `<td>${r[h] || ''}</td>`).join('') + '</tr>').join('')
                        + '</tbody></table>';
                    
                    categoriesLink.href = paths.freqCategories;
                    categoriesLink.style.display = 'inline-block';
                } else {
                    categoriesCard.style.display = 'none';
                }

                if(categoriesImgOk){
                    categoriesImgCard.style.display = 'block';
                    categoriesImg.src = paths.imgCategories;
                    categoriesImg.style.display = 'block';
                    categoriesImgMsg.textContent = '';
                } else {
                    categoriesImgCard.style.display = 'none';
                    categoriesImgMsg.textContent = 'Imagen no encontrada: ' + paths.imgCategories;
                }

                log('Carga finalizada.');
                showMsg('Carga finalizada.');
            } catch(err){
                log('Error general:', err.message);
                showMsg('Error: ' + err.message);
            } finally {
                btn.disabled = false;
            }
        });
    </script>
</div>
</body>
</html>